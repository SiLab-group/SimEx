

from simulator_controller import SimulatorController
from simulator import Simulator

# New results for the first and last value enabled in global_settings and sumo 1.21.0
# and sim_y_list [339.5416666666667, 346.1388888888888, 362.6805555555555, 372.5, 391.3055555555557, 396.61111111111103, 418.1666666666667, 425.0833333333333, 444.5, 481.09722222222234, 514.3055555555554, 595.3333333333331, 655.1527777777777, 720.3333333333335, 769.7777777777777, 794.9305555555558]
# mod_x_list = [[2500.0, 2600.0, 2681.5384615384614, 2766.153846153846, 2853.846153846154, 2944.6153846153848, 3038.4615384615386, 3135.3846153846152, 3235.3846153846152, 3338.4615384615386, 3444.6153846153848, 3553.846153846154, 3666.153846153846, 3781.5384615384614, 3900.0, 4000.0]]

# Super old results for the sumo 1.20.0 published in the paper. Can be reproduced if the sumo 1.20.0 is used.
mod_x_list = [[2600.0, 2681.5384615384614, 2766.153846153846, 2853.846153846154, 2944.6153846153848, 3038.4615384615386, 3135.3846153846152, 3235.3846153846152, 3338.4615384615386, 3444.6153846153848, 3553.846153846154, 3666.153846153846, 3781.5384615384614, 3900.0]]
# MODX [2600.0, 2681.5384615384614, 2766.153846153846, 2853.846153846154, 2944.6153846153848, 3038.4615384615386, 3135.3846153846152, 3235.3846153846152, 3338.4615384615386, 3444.6153846153848, 3553.846153846154, 3666.153846153846, 3781.5384615384614, 3900.0]
# sim_y_list [346.1388888888888, 361.94444444444434, 372.5, 395.5555555555556, 400.5138888888888, 415.4722222222221, 429.7361111111112, 454.18055555555554, 503.1249999999999, 546.1249999999998, 584.8194444444443, 678.402777777778, 730.6944444444441, 784.5833333333333]
def test_simulator_sumo_vsl():
	mod_x, sim_y_list = SimulatorController.simulate(mod_x_list, Simulator.sumo_simulator_vsl)
	# Sumo 1.21.0 results
	assert sim_y_list == [346.1388888888888, 362.00000000000006, 372.5, 394.84722222222223, 399.4444444444445, 415.73611111111126, 429.7361111111112, 463.18055555555577, 497.1805555555555, 547.9722222222221, 592.3194444444442, 678.4305555555555, 745.8611111111111, 785.5138888888893]
	# Values for add first and last point enabled
	# assert sim_y_list == [339.5416666666667, 346.1388888888888, 362.6805555555555, 372.5, 391.3055555555557, 396.61111111111103, 418.1666666666667, 425.0833333333333, 444.5, 481.09722222222234, 514.3055555555554, 595.3333333333331, 655.1527777777777, 720.3333333333335, 769.7777777777777, 794.9305555555558]
	# There are the results for sumo 1.21.0
	# assert sim_y_list == [346.1388888888888, 361.94444444444434, 372.5, 395.5555555555556, 400.5138888888888, 415.4722222222221, 429.7361111111112, 454.18055555555554, 503.1249999999999, 546.1249999999998, 584.8194444444443, 678.402777777778, 730.6944444444441, 784.5833333333333]
def test_simulator_sumo_vsl_parallel():
	mod_x, sim_y_list = SimulatorController.simulate_parallel(mod_x_list, Simulator.sumo_simulator_vsl, workers=14)
	# Sumo 1.21.0 results
	assert sim_y_list == [346.1388888888888, 362.00000000000006, 372.5, 394.84722222222223, 399.4444444444445, 415.73611111111126, 429.7361111111112, 463.18055555555577, 497.1805555555555, 547.9722222222221, 592.3194444444442, 678.4305555555555, 745.8611111111111, 785.5138888888893]
	# Values for add first and last point enabled
	# assert sim_y_list == [339.5416666666667, 346.1388888888888, 362.6805555555555, 372.5, 391.3055555555557, 396.61111111111103, 418.1666666666667, 425.0833333333333, 444.5, 481.09722222222234, 514.3055555555554, 595.3333333333331, 655.1527777777777, 720.3333333333335, 769.7777777777777, 794.9305555555558]
	# These are the results for sumo 1.20.0
	# assert sim_y_list == [346.1388888888888, 361.94444444444434, 372.5, 395.5555555555556, 400.5138888888888, 415.4722222222221, 429.7361111111112, 454.18055555555554, 503.1249999999999, 546.1249999999998, 584.8194444444443, 678.402777777778, 730.6944444444441, 784.5833333333333]


# We do not run these tests all the time to safe resources in GH
# def test_simulator_sumo_novsl_():
# 	mod_x, sim_y_list = SimulatorController.simulate(mod_x_list, Simulator.sumo_simulator_novsl)
# 	# Results for sumo 1.21.0
# 	assert sim_y_list == [346.1388888888888, 362.00000000000006, 372.5, 392.8194444444444, 396.61111111111103, 418.1666666666667, 426.43055555555554, 443.01388888888874, 488.27777777777766, 517.0694444444443, 599.2500000000001, 678.7777777777779, 708.5416666666667, 774.166666666667]
#
# def test_simulator_sumo_novsl_parallel():
# 	mod_x, sim_y_list = SimulatorController.simulate_parallel(mod_x_list, Simulator.sumo_simulator_novsl, workers=14)
# 	# Results for sumo 1.21.0
# 	assert sim_y_list == [346.1388888888888, 362.00000000000006, 372.5, 392.8194444444444, 396.61111111111103, 418.1666666666667, 426.43055555555554, 443.01388888888874, 488.27777777777766, 517.0694444444443, 599.2500000000001, 678.7777777777779, 708.5416666666667, 774.166666666667]